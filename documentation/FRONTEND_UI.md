# Фронтенд и UI MGCOM Finance AI

## 1. Общий интерфейс

Главный экран MGCOM Finance AI представляет собой **корпоративный BI‑дашборд**:

- **Верхняя панель (header)**:
  - логотип с аббревиатурой `MG`;
  - название проекта: `MGCOM Finance AI`;
  - подпись: «Таблицы + ИИ‑чат по корпоративным данным»;
  - переключатель светлой/тёмной темы (`ThemeToggle`).
- **Основная область**:
  - слева — блок таблицы с заголовком, описанием и интерактивной `DataTable`;
  - справа — боковая панель чата с ИИ (`ChatPanel`).

Визуальный стиль строится на базе дизайн‑системы из `DESIGN_SYSTEM.md`: тёмно‑синий corporate‑нави, светлый фон, акценты золотистого цвета, высокая читаемость и доступность.

## 2. Структура фронтенда

Ключевые файлы:

- `src/app/layout.tsx` — общий layout приложения: шрифты, глобальные стили, язык документа (`ru`).
- `src/app/page.tsx` — главная страница, инициализация дашборда.
- `src/app/globals.css` — Tailwind + CSS‑переменные для тем и фон/текст.
- `src/components/Dashboard.tsx` — композиция таблицы и чата.
- `src/components/DataTable.tsx` — табличный компонент.
- `src/components/ChatPanel.tsx` — чат с ИИ.
- `src/components/ThemeToggle.tsx` — переключатель темы.

## 3. Темы и дизайн‑система

### 3.1. Темы

Тема управляется через атрибут `data-theme` на элементе `html`:

- `light` (по умолчанию) и `dark` (тёмная тема).
- Переменные в `globals.css`:
  - `--background`, `--foreground` — фон и цвет текста.
- `ThemeToggle`:
  - читает/записывает текущую тему в `localStorage` (`mgcom-theme`);
  - учитывает системную настройку `prefers-color-scheme` при первой инициализации;
  - визуально показывает текущую тему (иконка ☀/☾ и подпись).

### 3.2. Tailwind и шрифты

В `globals.css` импортируется Tailwind (`@import "tailwindcss";`), а дальнейшая настройка шрифтов и токенов темы будет опираться на дизайн‑систему из `DESIGN_SYSTEM.md` (Lexend / Source Sans 3 и корпоративные цвета).

## 4. Компонент `Dashboard`

Функции:

- Принимает `initialColumns` и `initialRows` (демо‑таблица с сервера).
- Хранит состояние:
  - `currentTable` — активная таблица (`clients`, `contacts`, `tenders`);
  - `columns`, `rows` — текущие данные;
  - `activeRequest` — последний запрос от ИИ;
  - `loading` — индикатор загрузки при смене таблицы.
- Отображает:
  - заголовок блока таблицы: «Таблица данных: Клиенты/Контакты/Тендеры»;
  - подзаголовок с описанием из `activeRequest.description` (если есть).
- Передаёт в `DataTable`:
  - текущие `columns`, `rows` и `activeRequest`.
- Подключает `ChatPanel` и обрабатывает callback `onApplyRequest`, чтобы:
  - обновлять `activeRequest`;
  - при смене `table` вызывать `/api/data` и подменять данные.

## 5. Компонент `DataTable`

Возможности:

- **Фильтрация**:
  - отдельный текстовый или числовой инпут под заголовком каждой колонки;
  - логика фильтрации учитывает `operator` из `TableRequest` (если есть) и тип колонки (`string`, `number`, `date`).
- **Сортировка**:
  - управление по клику на заголовок колонки;
  - индикаторы направления (`▲`, `▼`, `⇅`).
- **Пагинация**:
  - информация о текущей странице и общем числе страниц;
  - кнопки «Назад»/«Вперёд»;
  - выбор размера страницы (10/25/50).
- **Управление колонками**:
  - дропдаун «Колонки» с чекбоксами;
  - возможность скрывать/показывать отдельные колонки.
- **Экспорт CSV**:
  - экспортирует текущие данные с учётом фильтров и выбранных колонок;
  - формирует CSV с разделителем `;` и экранированием кавычек.

Интеграция с ИИ:

- При получении нового `activeRequest`:
  - настраивает видимые колонки под `request.columns` (если указано);
  - применяет сортировку по `request.sort`;
  - выставляет фильтры (`request.filters`) с маппингом имён полей к реальным колонкам (поддержка «похожих» названий).

## 6. Компонент `ChatPanel`

Ключевой UX:

- Список сообщений с разделением по ролям:
  - сообщения пользователя — справа, тёмный фон;
  - сообщения ИИ — слева, светлый/тёмный фон в зависимости от темы.
- При ответе ИИ, если есть `request`, показывается краткое резюме:
  - какая таблица выбрана (`table`);
  - есть ли сортировка (`sort`);
  - количество фильтров.
- Внизу:
  - текстовая область ввода;
  - кнопка отправки (состояние `loading`);
  - чипы‑подсказки примерных запросов («Покажи тендеры за прошлый месяц» и т.п.).

Логика:

- Хранит локальную историю диалога;
- Отправляет запросы на `/api/chat` с текущим сообщением и историей;
- При получении ответа:
  - добавляет сообщение ИИ в историю;
  - при наличии `tableRequest` вызывает `onApplyRequest`.

## 7. Глобальные стили (`globals.css`)

Основные задачи:

- Определить базовые цвета фона и текста через CSS‑переменные;
- Настроить базовый шрифт для `body` (в дальнейшем будет синхронизирован с дизайн‑системой: Lexend/Source Sans 3);
- Подключить Tailwind CSS и токены (`@theme inline`).

## 8. UX‑принципы

С опорой на `DESIGN_SYSTEM.md`:

- **Доступность**:
  - контрастные цвета;
  - удобные кликабельные области;
  - понятные подписи.
- **Фокус на данных**:
  - минимум визуального шума;
  - акцент на таблице и чате;
  - подписи/описания для текущего состояния выборки.
- **Прозрачность работы ИИ**:
  - пользователь видит не только текст ответа, но и краткое описание того, что изменилось в таблице (таблица, сортировка, фильтры).

